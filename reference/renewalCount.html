<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Fit renewal count processes regression models — renewalCount • Countr</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Fit renewal count processes regression models — renewalCount"><meta property="og:description" content="Fit renewal regression models for count data via maximum likelihood."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Countr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.5.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/GeoBosh/Countr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit renewal count processes regression models</h1>
    <small class="dont-index">Source: <a href="https://github.com/GeoBosh/Countr/blob/HEAD/R/renewal_cstr.R" class="external-link"><code>R/renewal_cstr.R</code></a></small>
    <div class="hidden name"><code>renewalCount.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fit renewal regression models for count data via maximum likelihood.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">renewalCount</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">subset</span>,</span>
<span>  <span class="va">na.action</span>,</span>
<span>  <span class="va">weights</span>,</span>
<span>  <span class="va">offset</span>,</span>
<span>  dist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"weibull"</span>, <span class="st">"weibullgam"</span>, <span class="st">"custom"</span>, <span class="st">"gamma"</span>, <span class="st">"gengamma"</span><span class="op">)</span>,</span>
<span>  anc <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  convPars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  link <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  time <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="renewal.control.html">renewal.control</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>,</span>
<span>  customPars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  seriesPars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  weiMethod <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  computeHessian <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  standardise <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  standardise_scale <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  model <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  y <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  x <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>formula</dt>
<dd><p>a formula object. If it is a standard formula object, the left
hand side specifies the response variable and the right hand sides
specifies the regression equation for the first parameter of the
conditional distribution. <code>formula</code> can also be used to specify the
ancilliary regressions, using the operator `|`, see Details.</p></dd>


<dt>data, subset, na.action, </dt>
<dd><p>arguments controlling formula processing via
<code>model.frame</code>.</p></dd>


<dt>weights</dt>
<dd><p>optional numeric vector of weights.</p></dd>


<dt>offset</dt>
<dd><p>optional numeric vector with an a priori known component to be
included in the linear predictor of the count model. Currently not used.</p></dd>


<dt>dist</dt>
<dd><p>character, built-in distribution to be used as the inter-arrival
time distribution or <code>"custom"</code> for a user defined distribution, see
Details. Currently the built-in distributions are <code>"weibull"</code>,
<code>"weibullgam"</code>, <code>"gamma"</code>, <code>"gengamma"</code>
(generalized-gamma) and <code>"burr"</code>.</p></dd>


<dt>anc</dt>
<dd><p>a named list of formulas for ancillary regressions, if any,
otherwise <code>NULL</code>. The formulas associated with the (exact) parameter
names are used. The left-hand sides of the formulas in <code>anc</code> are
ignored.</p></dd>


<dt>convPars</dt>
<dd><p>a list of convolution parameters arguments with slots
<code>nsteps</code>, <code>extrap</code> and <code>convMethod</code>, see
<code>dCount_conv_bi</code>. If NULL, default parameters will be applied.</p></dd>


<dt>link</dt>
<dd><p>named list of character strings specifying the name of the link
functions to be used in the regression. If <code>NULL</code>, the canonical
link function will be used, i.e, <code>log</code> if the parameter is supposed
to be positive, identity otherwise.</p></dd>


<dt>time</dt>
<dd><p>numeric, time at which the count is observed; default to unity
(1).</p></dd>


<dt>control</dt>
<dd><p>a list of control arguments specified via
<code>renewal.control</code>.</p></dd>


<dt>customPars</dt>
<dd><p>list, user inputs if <code>dist = "custom"</code>, see details.</p></dd>


<dt>seriesPars</dt>
<dd><p>list, series expansion input parameters with slots
<code>terms</code> (number of terms in the series expansion), <code>iter</code>
(number of iteration in the accelerated series expansion algorithm) and
<code>eps</code> (tolerance in the accelerated series expansion algorithm),
Only used if <code>dist = "weibull"</code> and <code>weiMethod =
c("series_mat", "series_acc")</code>.</p></dd>


<dt>weiMethod</dt>
<dd><p>character, computation method to be used if <code>dist =
"weibull"</code> or <code>"weibullgam"</code>, see <code>dWeibullCount</code> and
<code>dWeibullgammaCount</code>.</p></dd>


<dt>computeHessian</dt>
<dd><p>logical, should the hessian (and hence the covariance
matrix) be computed numerically at the fitted values.</p></dd>


<dt>standardise</dt>
<dd><p>logical should the covariates be standardised using
<code><a href="https://rdrr.io/pkg/standardize/man/standardize.html" class="external-link">standardize::standardize()</a></code> function.</p></dd>


<dt>standardise_scale</dt>
<dd><p>numeric the desired scale for the covariates;
default to 1</p></dd>


<dt>model, y, x</dt>
<dd><p>logicals. If <code>TRUE</code> the corresponding components of the
fit (model frame, response, model matrix) are returned.</p></dd>


<dt>...</dt>
<dd><p>arguments passed to <code>renewal.control</code> in the default setup.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>An <code>S3</code> object of class "renewal", which is a list with
    components including:</p>
<p></p>
<dl><dt>coefficients</dt>
<dd><p>values of the fitted coefficients.</p></dd>


    <dt>residuals</dt>
<dd><p>vector of weighted residuals \(\omega * (observed -
    fitted)\).</p></dd>


    <dt>fitted.values</dt>
<dd><p>vector of fitted means.</p></dd>


    <dt>optim</dt>
<dd><p>data.frame output of <code>optimx</code>.</p></dd>


    <dt>method</dt>
<dd><p>optimisation algorithm.</p></dd>


    <dt>control</dt>
<dd><p>the control arguments, passed to <code>optimx</code>.</p></dd>


    <dt>start</dt>
<dd><p>starting values, passed to <code>optimx</code>.</p></dd>


    <dt>weights</dt>
<dd><p>weights to apply, if any.</p></dd>


    <dt>n</dt>
<dd><p>number of observations (with weights &gt; 0).</p></dd>


    <dt>iterations</dt>
<dd><p>number of iterations in the optimisation algorithm.</p></dd>


    <dt>execTime</dt>
<dd><p>duration of the optimisation.</p></dd>


    <dt>loglik</dt>
<dd><p>log-likelihood of the fitted model.</p></dd>


    <dt>df.residual</dt>
<dd><p>residuals' degrees of freedom for the fitted model.</p></dd>


    <dt>vcoc</dt>
<dd><p>convariance matrix of all coefficients, computed numerically
    from the hessian at the fitted coefficients (if <code>computeHessian</code> is
    <code>TRUE</code>).</p></dd>


    <dt>dist</dt>
<dd><p>name of the inter-arrival distribution.</p></dd>


    <dt>link</dt>
<dd><p>list, inverse link function corresponding to each parameter in
    the inter-arrival distribution.</p></dd>


    <dt>converged</dt>
<dd><p>logical, did the optimisation algorithm converge?</p></dd>


    <dt>data</dt>
<dd><p>data used to fit the model.</p></dd>


    <dt>formula</dt>
<dd><p>the original formula.</p></dd>


    <dt>call</dt>
<dd><p>the original function call.</p></dd>


    <dt>anc</dt>
<dd><p>named list of formulas to model regression on ancillary
    parameters.</p></dd>


    <dt>score_fct</dt>
<dd><p>function to compute the vector of scores defined in
    Cameron(2013) equation 2.94.</p></dd>


    <dt>convPars</dt>
<dd><p>convolution inputs used.</p></dd>


    <dt>customPars</dt>
<dd><p>named list, user passed distribution inputs, see
    Details.</p></dd>


    <dt>time</dt>
<dd><p>observed window used, default is 1.0 (see inputs).</p></dd>


    <dt>model</dt>
<dd><p>the full model frame (if <code>model = TRUE</code>).</p></dd>


    <dt>y</dt>
<dd><p>the response count vector (if <code>y = TRUE</code>).</p></dd>


    <dt>x</dt>
<dd><p>the model matrix (if <code>x = TRUE</code>).</p></dd>


</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p><code>renewal</code> re-uses design and functionality of the basic R tools for
fitting regression model (<code>lm</code>, <code>glm</code>) and is highly inspired by
<code>hurdle()</code> and <code>zeroinfl()</code> from package <code>pscl</code>. Package
<code>Formula</code> is used to handle formulas.</p>
<p>Argument <code>formula</code> is a <code>formula</code> object. In the simplest case its
left-hand side (lhs) designates the response variable and the right-hand side
the covariates for the first parameter of the distribution (as reported by
<code><a href="getParNames.html">getParNames</a></code>. In this case, covariates for the ancilliary
parameters are specified using argument <code>anc</code>.</p>
<p>The ancilliary regressions, can also be specified in argument <code>formula</code>
by adding them to the righ-hand side, separated by the operator ‘|’.
For example <code>Y | shape ~ x + y | z</code> can be used in place of the pair
<code>Y ~ x + y</code> and <code>anc = list(shape = ~z)</code>. In most cases, the name
of the second parameter can be omitted, which for this example gives the
equivalent <code>Y ~ x + y | z</code>. The actual rule is that if the parameter is
missing from the left-hand side, it is inferred from the default parameter
list of the distribution.</p>
<p>As another convenience, if the parameters are to to have the same covariates,
it is not necessary to repeat the rhs. For example, <code>Y | shape ~ x + y</code>
is equivalent to <code>Y | shape ~ x + y | x + y</code>. Note that this is applied
only to parameters listed on the lhs, so <code>Y ~ x + y</code> specifies
covariates only for the response variable and not any other parameters.</p>

<p>Distributions for inter-arrival times supported internally by this package
can be chosen by setting argument <code>"dist"</code> to a suitable character
string.  Currently the built-in distributions are <code>"weibull"</code>,
<code>"weibullgam"</code>, <code>"gamma"</code>, <code>"gengamma"</code> (generalized-gamma)
and <code>"burr"</code>.</p>
<p>Users can also provide their own inter-arrival distribution.  This is done by
setting argument <code>"dist"</code> to <code>"custom"</code>, specifying the initial
values and giving argument <code>customPars</code> as a list with the following
components:</p>
<dl><dt>parNames</dt>
<dd><p>character, the names of the parameters of the distribution.
    The location parameter should be the first one.</p></dd>


<dt>survivalFct</dt>
<dd><p>function object containing the survival function. It
    should have signature <code>function(t, distPars)</code> where <code>t</code> is the
    point where the survival function is evaluated and <code>distPars</code> is the
    list of the distribution parameters. It should return a double value.</p></dd>


<dt>extrapolFct</dt>
<dd><p>function object computing the extrapolation values
    (numeric of length 2) from the value of the distribution parameters (in
    <code>distPars</code>). It should have signature <code>function(distPars)</code> and
    return a numeric vector of length 2. Only required if the extrapolation
    is set to <code>TRUE</code> in <code>convPars</code>.</p></dd>


</dl><p>Some checks are done to validate <code>customPars</code> but it is user's
responsibility to make sure the the functions have the appropriate
signatures.</p>
<p><strong>Note:</strong> The Weibull-gamma distribution is an experimental version and
should be used with care! It is very sensitive to initial values and there is no
guarantee of convergence. It has also been reparameterized in terms of
\((1/r, 1/\alpha, c)\) instead of \((r, \alpha,
c)\), where \(r\) and \(\alpha\) are the shape
and scale of the gamma distribution and \(c\) is the shape of the Weibull
distribution.</p>
<p><strong>(2017-08-04(Georgi) experimental feature:</strong> probability residuals in
component 'probResiduals'. I also added type 'prob' to the method for
residuals() to extract them.</p>
<p>probResiduals[i] is currently 1 - Prob(Y[i] given the
covariates). "one minus", so that values close to zero are "good".  On its
own this is probably not very useful but when comparing two models, if one of
them has mostly smaller values than the other, there is some reason to claim
that the former is superior. For example (see below), gamModel &lt; poisModel in
3:1</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Kharrat T, Boshnakov GN, McHale I, Baker R (2019).
“Flexible Regression Models for Count Data Based on Renewal Processes: The Countr Package.”
<em>Journal of Statistical Software</em>, <b>90</b>(13), 1--35.
<a href="https://doi.org/10.18637/jss.v090.i13" class="external-link">doi:10.18637/jss.v090.i13</a>
.</p>
<p>Cameron AC, Trivedi PK (2013).
<em>Regression analysis of count data</em>, volume 53.
Cambridge university press.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">## may take some time to run depending on your CPU</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">football</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">wei</span> <span class="op">=</span> <span class="fu">renewalCount</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">homeTeamGoals</span> <span class="op">~</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>                    data <span class="op">=</span> <span class="va">football</span>, dist <span class="op">=</span> <span class="st">"weibull"</span>, weiMethod <span class="op">=</span> <span class="st">"series_acc"</span>,</span></span>
<span class="r-in"><span>                    computeHessian <span class="op">=</span> <span class="cn">FALSE</span>, control <span class="op">=</span> <span class="fu"><a href="renewal.control.html">renewal.control</a></span><span class="op">(</span>trace <span class="op">=</span> <span class="fl">0</span>, </span></span>
<span class="r-in"><span>                    method <span class="op">=</span> <span class="st">"nlminb"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Tarak Kharrat, Georgi N. Boshnakov.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

